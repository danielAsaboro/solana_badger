#!/bin/bash

# Standalone Exploit Demonstrations Runner
# Executes all 6 vulnerability exploit scripts sequentially

set -e

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                           â•‘"
echo "â•‘  Solana Security Reference - Exploit Demonstrations      â•‘"
echo "â•‘                                                           â•‘"
echo "â•‘  Running all 6 vulnerability exploits...                 â•‘"
echo "â•‘                                                           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check dependencies
if ! command -v npx &> /dev/null; then
    echo "âŒ Error: npx not found. Please install Node.js and npm."
    exit 1
fi

if ! command -v ts-node &> /dev/null; then
    echo "Installing dependencies..."
    npm install
fi

# Track success/failure
TOTAL=6
SUCCESS=0
FAILED=0

# Run each exploit
echo "Starting exploit demonstrations..."
echo ""

exploits=(
    "1-signer-checks-exploit.ts"
    "2-owner-checks-exploit.ts"
    "3-arbitrary-cpi-exploit.ts"
    "4-reinitialization-exploit.ts"
    "5-type-cosplay-exploit.ts"
    "6-pda-sharing-exploit.ts"
)

for exploit in "${exploits[@]}"; do
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "Running: $exploit"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""

    if npx ts-node "$exploit"; then
        ((SUCCESS++))
        echo ""
        echo "âœ… $exploit completed successfully"
    else
        ((FAILED++))
        echo ""
        echo "âŒ $exploit failed"
    fi

    echo ""
    sleep 1
done

# Summary
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                           â•‘"
echo "â•‘  Exploit Demonstrations Complete                         â•‘"
echo "â•‘                                                           â•‘"
echo "â•‘  Total: $TOTAL                                                   â•‘"
echo "â•‘  Success: $SUCCESS                                                 â•‘"
echo "â•‘  Failed: $FAILED                                                  â•‘"
echo "â•‘                                                           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

if [ $FAILED -eq 0 ]; then
    echo "ğŸ‰ All exploits demonstrated successfully!"
    exit 0
else
    echo "âš ï¸  Some exploits failed. Check output above for details."
    exit 1
fi
